var fqnRoot,allNodes={},allLeaves={};
$(function(){var h={},k=function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())},m=function(a,b){return a.name.localeCompare(b.name)},n=function(a,b){return a.id>b.id?1:-1},p=function(a,b){return b.id>a.id?1:-1},f=k,e=function(a,b,c){this.name=a;this.id=b;this.parent=c;this.depth=null!==c?c.depth+1:0;this.expanded=!1;this.branch=null;allNodes[this.id]=this};e.prototype.getFullName=function(){return 0===this.depth?"\\":this.name};e.prototype.resort=function(){null!==this.branch&&
this.branch.resort(!0)};e.prototype.toggleExpand=function(){var a=this;null===this.branch?(this.branch=h,this.$ph.addClass("disabled"),ajax("fqn.api",{data:0<this.depth?{parent:this.id}:{},success:function(b){a.branch=new g(a,b);a.expanded=!0;a.$ph.removeClass("disabled").text("Collapse");a.$br.removeClass("branch-hidden");a.$br.append(a.branch.$())}})):this.branch!==h&&(this.expanded?(this.expanded=!1,this.$ph.text("Expand"),this.$br.addClass("branch-hidden")):(this.expanded=!0,this.$ph.text("Collapse"),
this.$br.removeClass("branch-hidden")))};e.prototype.$=function(){var a=this;if(void 0!==this.$div)return this.$div;this.$div=$("<div class='node'></div>");this.$label=$("<p class='node-label'></p>").append($("<code class='code'></code>").text(this.getFullName())).appendTo(this.$div);this.$ph=$("<span class='action'>Expand</span>").appendTo(this.$label);this.$br=$("<div class='branch branch-hidden'></div>").appendTo(this.$div);this.$ph.click(function(){return a.toggleExpand()});this.$div.attr("data-id",
this.id);return this.$div};var l=function(a,b,c,d,e){this.name=a;this.id=b;this.projects=c;this.builds=d;this.parent=e;allLeaves[this.id]=this};l.prototype.$=function(){if(void 0!==this.$div)return this.$div;this.$div=$("<div></div>");this.$label=$("<p></p>").append($("<code class='leaf-label code'></code>").text(this.parent.getFullName()+"\\"+this.name)).append($("<span class='leaf-usage'></span>").text(this.projects+" project"+(1<this.projects?"s":"")+", "+this.builds+" build"+(1<this.builds?"s":
""))).appendTo(this.$div);this.$div.attr("data-id",this.id);return this.$div};var g=function(a,b){this.parent=a;this.nodes=[];this.leaves=[];for(var c=0;c<b.length;++c){var d=b[c];"ns"===d.type?this.nodes.push(new e(d.name,d.id,a)):"class"===d.type&&this.leaves.push(new l(d.name,d.id,d.projects,d.builds,a))}this.resort(!1)};g.prototype.resort=function(a){this.nodes.sort(f);this.leaves.sort(f);if(a)for(this.$nodes.children().sortElements(function(a,c){return f(allNodes[a.getAttribute("data-id")],allNodes[c.getAttribute("data-id")])}),
this.$leaves.children().sortElements(function(a,c){return f(allLeaves[a.getAttribute("data-id")],allLeaves[c.getAttribute("data-id")])}),a=0;a<this.nodes;++a)this.nodes[a].resort()};g.prototype.$=function(){if(void 0!==this.$div)return this.$div;this.$div=$("<div></div>");this.$nodes=$("<div></div>").appendTo(this.$div);this.$leaves=$("<div></div>").appendTo(this.$div);for(var a=0;a<this.nodes.length;++a)this.$nodes.append(this.nodes[a].$());for(a=0;a<this.leaves.length;++a)this.$leaves.append(this.leaves[a].$());
return this.$div};fqnRoot=new e("",0,null);$("#tree-container").append(fqnRoot.$());fqnRoot.toggleExpand();$("#sort-fqn").change(function(){switch(this.value){case "SORT_NAME_NO_CASE":var a=k;break;case "SORT_NAME_CASE":a=m;break;case "SORT_ID":a=n;break;case "SORT_ID_REVERSE":a=p}f=a;fqnRoot.resort()})});
