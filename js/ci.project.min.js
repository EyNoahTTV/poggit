var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,l,g){c instanceof String&&(c=String(c));for(var m=c.length,h=0;h<m;h++){var r=c[h];if(l.call(g,r,h,c))return{i:h,v:r}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,l,g){c!=Array.prototype&&c!=Object.prototype&&(c[l]=g.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,l,g,m){if(l){g=$jscomp.global;c=c.split(".");for(m=0;m<c.length-1;m++){var h=c[m];h in g||(g[h]={});g=g[h]}c=c[c.length-1];m=g[c];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,g){return $jscomp.findInternal(this,c,g).v}},"es6","es3");
$(function(){function c(a){var b=document.getElementById("body");a.dialog("option","width",.8*b.clientWidth);a.dialog("option","height",.8*window.innerHeight)}function l(a){var b=t(!0);null!==b&&b.dialog("option","title",a);B.text(a)}function g(a,b,d){var e=getRelativeRootPath()+"ci/"+projectData.path.join("/")+"/"+PoggitConsts.BuildClass[a].toLowerCase()+":"+b;d||history.pushState(null,"",e);document.title=PoggitConsts.BuildClass[a]+" Build #"+b+" @ "+projectData.path[2]+" ("+projectData.path[0]+
"/"+projectData.path[1]+")";l(PoggitConsts.BuildClass[a]+" Build #"+b);v=!0;w?n.showNarrow():n.showWide();var f=Math.random();C=f;k.find(".ci-build-loading").css("display","block");k.find(".ci-build-section-content").css("display","none");d=null;for(var c in p)if(e=p[c],e.internal===b&&e.class===a&&"undefined"!==typeof e.statuses){d=e;break}null!==d&&void 0!==d.statuses?m(d):ajax("ci.build.request",{data:{projectId:projectData.project.projectId,"class":a,internal:b},success:function(a){p[a.buildId]=
a;C===f&&(m(a),D(a))},error:function(){alert(projectData.project.projectName+" "+PoggitConsts.BuildClass[a]+"#"+b+" does not exist!")}})}function m(a){k.find(".ci-build-loading").css("display","none");k.find("#ci-build-sha").text(a.sha);k.find(".ci-build-commit-message").attr("data-sha",a.sha).empty();void 0!==a.commitMessage&&E(a.sha,a.commitMessage,a.authorName,a.authorLogin);var b=k.find("#ci-build-download");b.empty();var d=getRelativeRootPath()+"r/"+a.resourceId+"/"+projectData.path[2]+"_"+PoggitConsts.BuildClass[a.class].toLowerCase()+
"-"+a.internal+".phar";b.append(1===a.resourceId?"Not available.":$("<p style='margin-bottom: 0;'>"+(1===projectData.project.projectType?"Plugin:":"Virion:")+" </p>").append($("<a style='color: #0275d8;'></a>").text(projectData.path[2]+"_"+PoggitConsts.BuildClass[a.class].toLowerCase()+"-"+a.internal+".phar ("+(Math.round(a.dlSize/102.4)/10).toString()+" KB)").attr("href",d).click(function(){var b=confirm("This build has not been reviewed, and it may contain dangerous code including viruses.Do you still want to download this file?");
gaEventCi(!0,!b,projectData.project.projectName,a.resourceId,!1);return b})));d="https://github.com/"+projectData.project.repoOwner+"/"+projectData.project.repoName+"/archive/"+a.sha+".zip";b.append($("<p style='margin-bottom: 0;'>Source Code: </p>").append($("<a style='color: #0275d8;'></a>").text(projectData.project.repoName+"-"+a.sha.slice(0,6)+".zip (via GitHub.com)").attr("href",d).click(function(){return confirm("This build has not been reviewed, and it may contain dangerous code including viruses.Do you still want to download the source code from GitHub ?")})));
b=k.find("#ci-build-virion");b.empty();d=!0;for(var c in a.virions)if(a.virions.hasOwnProperty(c)){var f=a.virions[c];b.append($("<li></li>").append($("<a></a>").attr("href","/babs/"+f.babs).text(c+" v"+f.version+" ("+f.branch+"@"+f.sha.substr(0,7)+")")));d&&(k.find(".ci-build-virion-section").css("display","block"),d=!1)}c=k.find("#ci-build-lint");c.empty();if(0===a.statuses.length)c.append("<h6>No problems have been found. Well done!</h6>");else for(b=0;b<a.statuses.length;++b)d=a.statuses[b],$("<div class='ci-build-lint-info'></div>").attr("data-class",
d.class).append($("<p class='remark'></p>").text("Severity: "+PoggitConsts.LintLevel[d.level])).append($("<div class='ci-build-lint-details'></div>").html(d.html)).appendTo(c);k.find(".ci-build-section-content").css("display","block")}function h(a){document.title=projectData.path[2]+" ("+projectData.path[0]+"/"+projectData.path[1]+")";a&&history.pushState(null,"",getRelativeRootPath()+"ci/"+projectData.path.join("/"));v=!1;w?n.hideNarrow():n.hideWide()}function r(a){var b=location.pathname.substring(getRelativeRootPath().length).split(/\//);
if(5<=b.length&&(b=/^(?:(dev|pr):)?(\d+)$/i.exec(b[4]),null!==b)){a=1;"undefined"!==typeof b[1]&&(a="pr"===b[1]?4:1);g(a,Number(b[2]),!0);return}a&&h(!1)}function x(a,b,d,c){b={projectId:projectData.project.projectId,branch:a,lt:b,count:d};c&&(b.pr="");ajax("build.history.new",{data:b,success:function(b){var f=$("#ci-project-history-table"),e,g=-1;for(e=0;e<b.length;++e)"undefined"===typeof p[b[e].buildId]&&(p[b[e].buildId]=b[e]),g=b[e].internal;for(e=0;e<b.length;++e)f.append(F(b[e].buildId));q=
{branch:a,tail:g,size:(null===q?0:q.size)+d,pr:c};$(".ci-project-history-locks").removeClass("disabled").prop("disabled",!1)}})}function F(a){var b=p[a];if("undefined"!==typeof b.$row)return b.$row;var d=$("<tr class='ci-project-history-content-row'></tr>"),c=null,f=null,h=null;null!==projectData.release&&a===projectData.release.buildId&&(3<projectData.release.state||3===projectData.release.state&&isLoggedIn()||projectData.writePerm)&&(h=getRelativeRootPath()+"p/"+projectData.release.name+"/"+projectData.release.version);
null!==projectData.preRelease&&a===projectData.preRelease.buildId&&(3<projectData.preRelease.state||3===projectData.preRelease.state&&isLoggedIn()||projectData.writePerm)&&(f=getRelativeRootPath()+"p/"+projectData.preRelease.name+"/"+projectData.preRelease.version);projectData.writePerm&&(1!==b.class||1!==projectData.project.projectType||projectData.project.private||(null===projectData.release&&null===projectData.preRelease?c="Submit":a>(projectData.release?projectData.release.buildId:0)&&a>(projectData.preRelease?
projectData.preRelease.buildId:0)&&(c="Update")),null!==c?(a=$("<button class='btn action'>"+c+"</button>").click(function(){var a=c.toLowerCase();if("submit"===a||"update"===a)$("#wait-spinner").modal(),window.location=getRelativeRootPath()+a+"/"+projectData.path.join("/")+"/"+b.internal}),$("<td class='ci-project-history-action-cell'></td>").append(a).appendTo(d)):(a="A newer build has already been submitted.",projectData.project.private?a="Private plugins cannot be submitted.":2===projectData.project.projectType&&
(a="Virion builds cannot be submitted."),$("<td class='ci-project-history-action-cell' style='text-align: center;'></td>").append($("<span class='ci-project-history-action-cell-text text-danger hover-title' title='"+a+"'>Unavailable</span>")).appendTo(d)));a=getRelativeRootPath()+"babs/"+b.buildId.toString(16);var k=function(){g(b.class,b.internal,!1);return!1};$("<td class='ci-project-history-build-number'></td>").append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text(PoggitConsts.BuildClass[b.class]+
" #"+b.internal).attr("href",a).click(k)).append(h?" <a style='color: red;' href='"+h+"'>[R]</a>":f?" <a style='color: red;' href='"+f+"'>[P]</a>":"")).append($("<p></p>").css("margin-bottom","0").append($("<a></a>").text("(&"+b.buildId.toString(16)+")").attr("href",a).click(k))).appendTo(d);$("<td class='ci-project-history-date'></td>").append($("<span class='time-elapse' data-max-elapse='604800'></span>").attr("data-timestamp",b.date)).appendTo(d);f=PoggitConsts.LintLevel[b.worstLint];$("<td class='ci-project-history-lint'></td>").addClass("lint-style-"+
f.toLowerCase().replace(" ","-")).append($("<p></p>").text(0===b.lintCount?"OK":b.lintCount+" problem"+(1!==b.lintCount?"s":"")).css("margin-bottom","0")).appendTo(d);$("<td class='ci-project-history-commit'></td>").hover(u(!0),u(!1)).append($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/commit/"+b.sha).append($("<code></code>").text(b.sha?b.sha.substring(0,7):"unknown"))).append($("<span></span>").addClass("ci-build-commit-message").attr("data-sha",
b.sha)).appendTo(d);f=$("<td class='ci-project-history-branch'></td>").appendTo(d);4===b.class?(f.text("#"+b.branch),f.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/pull/"+b.branch))):(f.text(b.branch),f.wrapInner($("<a target='_blank'></a>").attr("href","https://github.com/"+projectData.path[0]+"/"+projectData.path[1]+"/tree/"+b.branch+"/"+b.path)));f=getRelativeRootPath()+"r/"+b.resourceId+"/"+projectData.path[2]+"_"+PoggitConsts.BuildClass[b.class].toLowerCase()+
"-"+b.internal+".phar";$("<td class='ci-project-history-dl'></td>").append(1===b.resourceId?"N/A":$("<a></a>").text((Math.round(b.dlSize/102.4)/10).toString()+" KB").attr("href",f).click(function(){var a=confirm("This "+(2===projectData.project.projectType?"virion":"plugin")+" has not been reviewed, and it may contain dangerous code including viruses. Do you still want to download this file?");gaEventCi(!0,!a,projectData.project.projectName,b.resourceId,!1);return a})).appendTo(d);2===projectData.project.projectType&&
$("<td class='ci-project-history-virion-version'></td>").text(b.virionVersion).appendTo(d);D(b);return b.$row=d}function D(a){ghApi("repositories/"+projectData.project.repoId+"/commits/"+a.sha,{},"GET",function(b){a.commitMessage=b.commit?b.commit.message:"unknown";a.authorName=b.commit?b.commit.author.name:"unknown";a.authorLogin=b.commit?b.author.login:"unknown";E(b.sha,a.commitMessage,a.authorName,a.authorLogin)})}function E(a,b,c,e){$("span.ci-build-commit-message[data-sha='"+a+"']").each(function(){var a=
$(this);a.empty();a.text(b.split("\n")[0]);$("<span class='ci-build-commit-details'></span>").text(b.split("\n").slice(1).join("\n")).appendTo(a);$("<a target='_blank'></a>").attr("href","https://github.com/"+e).attr("title",c).append($("<img width='16'/>").attr("onerror","this.src='/res/ghMark.png'; this.onerror=null;").attr("src","https://github.com/"+e+".png?width=20").css("margin","5px")).prependTo(a)})}function u(a){return function(){$(this).find(".ci-build-commit-details").css("display",a?"block":
"none")}}var p={},q=null,k=$("#ci-build-inner"),y=$("#ci-build-pane");$("#ci-build-close").click(function(){h(!0)});var B=$("#ci-build-header"),v=!1,w,z=!1,C=null;k.find(".ci-build-commit-message").hover(u(!0),u(!1));var t=function(){var a;return function(b){if("undefined"!==typeof a)return a;if(b)return null;a=$("<div id='build-pane-dialog'></div>");a.dialog({autoOpen:!1,modal:!0,position:modalPosition,close:function(){z||h(!0)},open:function(a,b){$(".ui-widget-overlay").bind("click",function(){$("#build-pane-dialog").dialog("close")})}});
return a}}(),n={showNarrow:function(){var a=t();a.dialog("option","title",B.text());k.appendTo(a);c(a);a.dialog("open")},hideNarrow:function(){var a=t();z=!0;a.dialog("close");z=!1},showWide:function(){k.appendTo(y);y.css("display","flex")},hideWide:function(){y.css("display","none")}};(function(){function a(a){w=a;v&&(a?(n.hideWide(),n.showNarrow()):(n.hideNarrow(),n.showWide()))}var b=window.matchMedia("(max-width: 1000px)");a(b.matches);b.addListener(function(b){a(b.matches)});$(window).resize(function(){var a=
t(!0);null!==a&&c(a)})})();window.addEventListener("popstate",function(){r(!0)});r(!1);var G=document.getElementById("projectPath"),A=/^https:\/\/github\.com\/([a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38})\/([a-z0-9_.-]+)\/tree\/master\/?(.*)/i.exec(G.href);ghApi("repos/"+A[1]+"/"+A[2],{},"GET",function(a){G.href="https://github.com/"+a.full_name+"/tree/"+a.default_branch+"/"+A[3]});var H=getParameterByName("branch","special:dev");$("#ci-project-history-branch-select").val(H);x(H,-1,10);$("#ci-project-history-load-more").click(function(){$(this).hasClass("disabled")||
($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),null!==q&&x(q.branch,q.tail,10,q.pr))});$("#ci-project-history-branch-select").change(function(){function a(a,b){return"special:dev"===b?!0:"special:pr"===b?4===a.class:b===a.branch}var b=$("#ci-project-history-table");b.find(".ci-project-history-content-row").detach();var c=this.value,e=Object.valuesToArray(p);e.sort(function(a,b){return b.date-a.date});for(var f=0,g=-1,h=0;h<e.length;++h)a(e[h],c)&&(b.append(F(e[h].buildId)),
++f,-1===g||g>e[h].internal)&&(g=e[h].internal);10>f&&($(".ci-project-history-locks").addClass("disabled").prop("disabled",!0),x(c,g,10-f,"special:pr"===c))})});
